"use strict";(self.webpackChunkmas_playbook=self.webpackChunkmas_playbook||[]).push([[2053],{7150:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return i},default:function(){return m}});var n=a(3366),r=(a(7294),a(4983)),o=a(4295),s=["components"],i={},l={_frontmatter:i},c=o.Z;function m(e){var t=e.components,a=(0,n.Z)(e,s);return(0,r.kt)(c,Object.assign({},l,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Starting 76 we can write scripts for cron tasks too. It follows the same principle as the endpoint\nhandler. We have a cron class - com.ibm.tivoli.maximo.script.ScriptCrontask that helps achieve\nthis. We need to register that class as a new crontask in the crontask application. We then will\ncreate an instance of it and set the “scriptname” property to the name of the script that we want\nthis task to run. Next we need to set the schedule and last but not the least - need to define the\nscript. We are then good to go running this newly defined script with the crontasks. It is no\ndifferent than any other crontasks and you can activate/deactivate the task or change the\nschedule as you would do in any other cron task."),(0,r.kt)("p",null,"If you are wondering why we need this when we already have an escalation which is a crontask\nthat works of a given Maximo object. The answer is simple - we often need to schedule jobs that\nare not just based off Maximo objects. So in those cases, this crontask based scripts would\ncome in handy."),(0,r.kt)("p",null,"Below we develop a cron script to log an error when the count of maxsessions exceeds a\nconfigured limit."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step 1"),"\nWe will first need to register the script crontask definition. For that we will use the Crontask app\nand the class name would be com.ibm.tivoli.maximo.script.ScriptCrontask. We will also need to\ncreate a cron task instance.\nIn that instance we can set the frequency to 30 sec.\nWe can set the SCRPTNAME param value to SESSIONCOUNT. This implies that we will create\na script names SESSIONCOUNT to do the job."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step 2"),"\nNext we create the script SESSIONCOUNT. A sample script in py is shown below. Note that the\n“runasUserInfo” implicit var will hold the userinfo for the cron job."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from psdi.server import MXServer\ncnt = MXServer.getMXServer().getMboSet("maxsession",runAsUserInfo).count();\nif cnt>1:\n  service.logError("cnt exceeds 1::"+str(cnt))\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step 3"),"\nNext we activate the crontask instance. You need to wait a minute or so for the task to start.\nYou can use another browser instance to login to maximo – just to create another maxsesson\nrecord. That is when you can see that log that says “cnt exceeds 1::“."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step 4"),"\nNote that we hard coded the count limit. In this step we can softcode this by leveraging the\nSCRIPTARG parameter in the Crontask. We can set that to 1. We need to now save and reload\nthe task."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step 5"),"\nNext we modify the script to leverage that SCRIPTARG parameter using the implicit var called\n“arg” as below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from psdi.server import MXServer\nargval = int(arg)\ncnt = MXServer.getMXServer().getMboSet("maxsession",runAsUserInfo).count();\nif cnt>argval:\n  service.logError("cnt exceeds 1::"+str(cnt))\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Step 6"),"\nYou can now repeat step 3 to see if you get the error log."))}m.isMDXComponent=!0},4295:function(e,t,a){a.d(t,{Z:function(){return E}});var n=a(7294),r=a(8650),o=a.n(r),s=a(5444),i=a(6949),l=a(3293),c=a(5900),m=a.n(c),d=function(e){var t,a=e.title,r=e.theme,o=e.tabs,s=void 0===o?[]:o;return n.createElement("div",{className:m()("PageHeader-module--page-header--NqfPe",(t={},t["PageHeader-module--with-tabs--vbQ-W"]=s.length,t["PageHeader-module--dark-mode--WCeH8"]="dark"===r,t))},n.createElement("div",{className:"bx--grid"},n.createElement("div",{className:"bx--row"},n.createElement("div",{className:"bx--col-lg-12"},n.createElement("h1",{id:"page-title",className:"PageHeader-module--text--Er2EO"},a)))))},p=function(e){var t=e.relativePagePath,a=e.repository,r=(0,s.useStaticQuery)("1364590287").site.siteMetadata.repository,o=a||r,i=o.baseUrl,l=o.subDirectory,c=i+"/edit/"+o.branch+l+"/src/pages"+t;return i?n.createElement("div",{className:"bx--row EditLink-module--row--BEmSX"},n.createElement("div",{className:"bx--col"},n.createElement("a",{className:"EditLink-module--link--IDrl1",href:c},"Edit this page on GitHub"))):null},h=a(4275),u=a(1721),g=function(e){function t(){return e.apply(this,arguments)||this}return(0,u.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,a=e.tabs,r=e.slug,i=r.split("/").filter(Boolean).slice(-1)[0],l=a.map((function(e){var t,a=o()(e,{lower:!0,strict:!0}),l=a===i,c=new RegExp(i+"/?(#.*)?$"),d=r.replace(c,a);return n.createElement("li",{key:e,className:m()((t={},t["PageTabs-module--selected-item--aBB0K"]=l,t),"PageTabs-module--list-item--024o6")},n.createElement(s.Link,{className:"PageTabs-module--link--Kz-7R",to:""+d},e))}));return n.createElement("div",{className:"PageTabs-module--tabs-container--Cdfzw"},n.createElement("div",{className:"bx--grid"},n.createElement("div",{className:"bx--row"},n.createElement("div",{className:"bx--col-lg-12 bx--col-no-gutter"},n.createElement("nav",{"aria-label":t},n.createElement("ul",{className:"PageTabs-module--list--xLqxG"},l))))))},t}(n.Component),w=g,f=a(2881),b=a(6958),k=a(36),v=function(e){var t=e.date,a=new Date(t);return t?n.createElement(k.X2,{className:"last-modified-date-module--row--XJoYQ"},n.createElement(k.sg,null,n.createElement("div",{className:"last-modified-date-module--text--ogPQF"},"Page last updated: ",a.toLocaleDateString("en-GB",{day:"2-digit",year:"numeric",month:"long"})))):null},E=function(e){var t=e.pageContext,a=e.children,r=e.location,c=e.Title,m=t.frontmatter,u=void 0===m?{}:m,g=t.relativePagePath,k=t.titleType,E=u.tabs,N=u.title,y=u.theme,x=u.description,S=u.keywords,P=u.date,T=(0,b.Z)().interiorTheme,C=(0,s.useStaticQuery)("2456312558").site.pathPrefix,I=C?r.pathname.replace(C,""):r.pathname,M=E?I.split("/").filter(Boolean).slice(-1)[0]||o()(E[0],{lower:!0}):"",W=y||T;return n.createElement(l.Z,{tabs:E,homepage:!1,theme:W,pageTitle:N,pageDescription:x,pageKeywords:S,titleType:k},n.createElement(d,{title:c?n.createElement(c,null):N,label:"label",tabs:E,theme:W}),E&&n.createElement(w,{title:N,slug:I,tabs:E,currentTab:M}),n.createElement(f.Z,{padded:!0},a,n.createElement(p,{relativePagePath:g}),n.createElement(v,{date:P})),n.createElement(h.Z,{pageContext:t,location:r,slug:I,tabs:E,currentTab:M}),n.createElement(i.Z,null))}}}]);
//# sourceMappingURL=component---src-pages-otherlaunch-cronscript-mdx-eef28b38a403db3cfd6b.js.map