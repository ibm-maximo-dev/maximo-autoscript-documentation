{
    "componentChunkName": "component---src-pages-integration-publishevents-mdx",
    "path": "/integration/publishevents/",
    "result": {"pageContext":{"frontmatter":{"title":"Publish channel scripting"},"relativePagePath":"/integration/publishevents.mdx","titleType":"append","MdxNode":{"id":"a2b8c37a-92a3-5249-8e63-d28400f214a9","children":[],"parent":"e663de7b-20c6-5269-945f-7148e19399d9","internal":{"content":"---\ntitle: Publish channel scripting\n---\n\nPublish Channels provide the outbound integration backbone of Maximo. They can be\nevent-enabled such that when some MBOs get added, updated or\ndeleted, these channels can trap those events and publish a message to the outbound JMS\nqueues. You can also do some offline exports using the channel from the Integration External systems application or from cron jobs invoking the export API of the channel.\nThe messages then get picked up from those queues and get pushed to their final\ndestination (using the endpoint/handler framework). Publish channels support the following script points:\n\n\n|Script point|Purpose|\n|:--------------|:---------------------------------------------------------|\n|Event Filters|Used for smart filtering of publish channel events|\n|External Exits|Used for data transformation of outbound messages from Maximo format (`irData`) to external format `erData`|\n|User Exit (Before External Exit)|Used for data updation without structural change to the Maximo format message (`irData`).|\n|User Exit (After External Exit)|Used for data transformation from the output of the External Exit to target external format.|\n\n\n\n## Event filters for Publish Channels\n\nYou may be required to filter the events in a way that the channel publishes the\nmessage only when a certain state condition is met. You could achieve this by writing event\nfilter classes in Java. Maximo 7.6 allows you to use scripts. To create a Filter script, use the **Script For Integration\" -> \"Publish Channel\" -> \"Event Filter** option in the Automation Scripting application. \n\n\n![Event Filter](evenfilter.jpg)\n\n\nThe following filter script is an example that can be used on the MXASSETInterface publish channel:\n\n\n```python\nif service.getMbo().isModified(\"status\") and service.getMbo().getString(\"status\")==\"BROKEN\":\n  evalresult = False\nevalresult = True\n```\n\nThe evalresult being set to False will indicate the event to be published. So effectively\nthis script will filter all events that did not change the status to APPR for the workorder. You\nmight wonder that this could have been done using a channel rule or channel exit class. That is\ndefinitely possible for simplistic rules, although this comes at a steep price. The rules get\nevaluated after the event has been serialized and then passed to the exit layer for evaluation.\nBy that time these rules get evaluated and you already paid the price of serialization. A better alternative is to skip it.\n\nThe event filters apply to event based publish channels. Publish channels that are\nused to export data cannot leverage these filters.\n\n\nAlso there is a bug which causes the “mbo” variable to not be accessible directly here.\nYou will have to use the service.getMbo() to get access to the event MBO here. \n\n\n## Exits for Publish Channels\n\nThere are three exit points for publish channels that can be scripted. \nThe purpose is mostly for data transformation, but it is not limited to that. \nYou can conceivably use the exit to make some direct calls to external services and then skip the rest of the Publish channel processing.\nThe following table lists some of the implicit variables that the publish channel scripts will have:\n\n\n|Variable|Purpose|\n|:--------------|:---------------------------------------------------------|\n|erData|An instance of psdi.iface.mic.StructureData used to hold the external document. The value of this variable is set to null for External Exits and Before User Exits in the channel.|\n|irData|An instance of psdi.iface.mic.StructureData used to hold the internal (Maximo format) document.|\n|ifaceType|The interface type name.|\n|ifaceName|The channel name.|\n|osName|The Object Structure name.|\n|messageType|The message type which can have values like Sync/Publish.|\n|extSystem|The external system name.|\n|userInfo|The UserInfo object representing the authenticated user that invoked this service.|\n|conn|The jdbc Connection object.|\n\n\n\nThe following screenshot is of the Integration Script Wizard for Publish Channel exits.\n\n\n![Event Filter](pubchannelexit.jpg)\n\n\nThe following script is an example that changes the description of operating assets on outbound transactions.\nIn this scenario, the MXASSET object structure provides `irData` (instance of psdi.iface.mic.StructureData) \nto the MXASSET publish channel (MXASSETINTERFACE) for processing. An automation script is configured to run on the \nexternal exit class of the publish channel. The script checks the status of the asset in the `irData `element. \nIf the asset is in operating status, the script inserts a value in the description field and prints a message to the log file. \nThe erData element is then constructed and is forwarded to the external system. If this is done as an external exit, the name of the script would be PUBLISH.MXASSETINTERFACE.EXTEXIT.OUT.\n\n\n```python\nif irData.getCurrentData(\"STATUS\") == 'OPERATING' :\n  irData.setCurrentData(\"DESCRIPTION\",\"hello\")\n  service.log(\"MYASSET description change\")\n```\n\nThe following example is of a user exit before the external exit that just sets the descriptions to the `irData` for the job tasks in a job plan.\n\n\n```python\njobTasks = irData.getChildrenData(\"JOBTASK\")\nnumberOfChildren = jobTasks.size()\nfor i in range(numberOfChildren):\n    logger.info(\"Inside Loop\" + str(i))\n    jT = jobTasks.get(i)\n    irData.setAsCurrent(jT)\n    taskPrefix = \"This is task number: \"\n    newDescription = taskPrefix + str(i)\n    irData.setCurrentData(\"DESCRIPTION\", newDescription)\nirData.setParentAsCurrent()\n```\n\nThis `irData` API usage is independent of json or xml. However, the `irData.setAsCurrent(jT)` API is the one that you should use so that it works for json and xml. \nIf instead you use the `irData.setAsCurrent(jobTasks, i)` API, it will only work for xml and not for json.\n\n\n","type":"Mdx","contentDigest":"a34f508405f4d2406d6b01be7a972dc5","owner":"gatsby-plugin-mdx","counter":177},"frontmatter":{"title":"Publish channel scripting"},"exports":{},"rawBody":"---\ntitle: Publish channel scripting\n---\n\nPublish Channels provide the outbound integration backbone of Maximo. They can be\nevent-enabled such that when some MBOs get added, updated or\ndeleted, these channels can trap those events and publish a message to the outbound JMS\nqueues. You can also do some offline exports using the channel from the Integration External systems application or from cron jobs invoking the export API of the channel.\nThe messages then get picked up from those queues and get pushed to their final\ndestination (using the endpoint/handler framework). Publish channels support the following script points:\n\n\n|Script point|Purpose|\n|:--------------|:---------------------------------------------------------|\n|Event Filters|Used for smart filtering of publish channel events|\n|External Exits|Used for data transformation of outbound messages from Maximo format (`irData`) to external format `erData`|\n|User Exit (Before External Exit)|Used for data updation without structural change to the Maximo format message (`irData`).|\n|User Exit (After External Exit)|Used for data transformation from the output of the External Exit to target external format.|\n\n\n\n## Event filters for Publish Channels\n\nYou may be required to filter the events in a way that the channel publishes the\nmessage only when a certain state condition is met. You could achieve this by writing event\nfilter classes in Java. Maximo 7.6 allows you to use scripts. To create a Filter script, use the **Script For Integration\" -> \"Publish Channel\" -> \"Event Filter** option in the Automation Scripting application. \n\n\n![Event Filter](evenfilter.jpg)\n\n\nThe following filter script is an example that can be used on the MXASSETInterface publish channel:\n\n\n```python\nif service.getMbo().isModified(\"status\") and service.getMbo().getString(\"status\")==\"BROKEN\":\n  evalresult = False\nevalresult = True\n```\n\nThe evalresult being set to False will indicate the event to be published. So effectively\nthis script will filter all events that did not change the status to APPR for the workorder. You\nmight wonder that this could have been done using a channel rule or channel exit class. That is\ndefinitely possible for simplistic rules, although this comes at a steep price. The rules get\nevaluated after the event has been serialized and then passed to the exit layer for evaluation.\nBy that time these rules get evaluated and you already paid the price of serialization. A better alternative is to skip it.\n\nThe event filters apply to event based publish channels. Publish channels that are\nused to export data cannot leverage these filters.\n\n\nAlso there is a bug which causes the “mbo” variable to not be accessible directly here.\nYou will have to use the service.getMbo() to get access to the event MBO here. \n\n\n## Exits for Publish Channels\n\nThere are three exit points for publish channels that can be scripted. \nThe purpose is mostly for data transformation, but it is not limited to that. \nYou can conceivably use the exit to make some direct calls to external services and then skip the rest of the Publish channel processing.\nThe following table lists some of the implicit variables that the publish channel scripts will have:\n\n\n|Variable|Purpose|\n|:--------------|:---------------------------------------------------------|\n|erData|An instance of psdi.iface.mic.StructureData used to hold the external document. The value of this variable is set to null for External Exits and Before User Exits in the channel.|\n|irData|An instance of psdi.iface.mic.StructureData used to hold the internal (Maximo format) document.|\n|ifaceType|The interface type name.|\n|ifaceName|The channel name.|\n|osName|The Object Structure name.|\n|messageType|The message type which can have values like Sync/Publish.|\n|extSystem|The external system name.|\n|userInfo|The UserInfo object representing the authenticated user that invoked this service.|\n|conn|The jdbc Connection object.|\n\n\n\nThe following screenshot is of the Integration Script Wizard for Publish Channel exits.\n\n\n![Event Filter](pubchannelexit.jpg)\n\n\nThe following script is an example that changes the description of operating assets on outbound transactions.\nIn this scenario, the MXASSET object structure provides `irData` (instance of psdi.iface.mic.StructureData) \nto the MXASSET publish channel (MXASSETINTERFACE) for processing. An automation script is configured to run on the \nexternal exit class of the publish channel. The script checks the status of the asset in the `irData `element. \nIf the asset is in operating status, the script inserts a value in the description field and prints a message to the log file. \nThe erData element is then constructed and is forwarded to the external system. If this is done as an external exit, the name of the script would be PUBLISH.MXASSETINTERFACE.EXTEXIT.OUT.\n\n\n```python\nif irData.getCurrentData(\"STATUS\") == 'OPERATING' :\n  irData.setCurrentData(\"DESCRIPTION\",\"hello\")\n  service.log(\"MYASSET description change\")\n```\n\nThe following example is of a user exit before the external exit that just sets the descriptions to the `irData` for the job tasks in a job plan.\n\n\n```python\njobTasks = irData.getChildrenData(\"JOBTASK\")\nnumberOfChildren = jobTasks.size()\nfor i in range(numberOfChildren):\n    logger.info(\"Inside Loop\" + str(i))\n    jT = jobTasks.get(i)\n    irData.setAsCurrent(jT)\n    taskPrefix = \"This is task number: \"\n    newDescription = taskPrefix + str(i)\n    irData.setCurrentData(\"DESCRIPTION\", newDescription)\nirData.setParentAsCurrent()\n```\n\nThis `irData` API usage is independent of json or xml. However, the `irData.setAsCurrent(jT)` API is the one that you should use so that it works for json and xml. \nIf instead you use the `irData.setAsCurrent(jobTasks, i)` API, it will only work for xml and not for json.\n\n\n","fileAbsolutePath":"/home/travis/build/maximo-app-framework/maximo-autoscript-documentation/src/pages/integration/publishevents.mdx"}}},
    "staticQueryHashes": ["1364590287","137577622","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}