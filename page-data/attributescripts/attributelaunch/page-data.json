{
    "componentChunkName": "component---src-pages-attributescripts-attributelaunch-mdx",
    "path": "/attributescripts/attributelaunch/",
    "result": {"pageContext":{"frontmatter":{"title":"Attribute Launchpoint"},"relativePagePath":"/attributescripts/attributelaunch.mdx","titleType":"append","MdxNode":{"id":"aac4be74-348a-5990-8348-7d9c8d045eb4","children":[],"parent":"5ff34a14-1019-5c75-9bdd-79334f68e230","internal":{"content":"---\ntitle: Attribute Launchpoint\n---\n\n## Attribute Launchpoint\nNext we cover the Attribute Launch Point where one can customize the field\nvalidation, action, initialization and lookups using the scripting framework. As before the script will\nhave access to the event Mbo [via implicit variable “mbo”] as well as all the\nrelated Mbos. In addition the modified attribute would also be available implicitly\nas a variable inside the script. The variable name would be the lower case value\nof the modified attribute name. The script will have access to the event Mbo [via the implicit variable\n`mbo`], the MboSet as well as all the related Mbos. A couple of examples below would help explain. \nTo design scripts using Attribute Launchpoint launch the “Create Scripts with Attribute Launch Point” wizard as shown below.\n\n![Attribute Launchpoint UI](alpui.jpg)\n\n\n### Validate and Action Events\nAs before we continue customizing the Asset Mbo. The use case this time is to\nadd custom business logic based on the Asset purchase price [attribute\npurchaseprice in Asset] value. For example we want to set the vendor field\nrequired or not required based on the purchaseprice attribute value and also to\ncalculate the replacement cost based on the purchase price. We also want to\nmake sure the purchase price does not exceed a maximum allowed value.  \n\nBased on the use case we know that the logic has to injected at the modification\nof the purchasprice attribute value – which implies it should be modeled as an\nAttribute Launch Point. Note that there is a validation element in the requirement - where the purchaseprice cannot exceed a certain limit. \nThere is also an action element wherein the state of the vendor attribute and the replacementcost value gets set based on the purchaseprice value. \nThe first requirement (of validation) should be handled by the Attriubute validate event and the 2nd one needs to be handled in the Attribute action event. \nBelow we show the screen shot for the events available in Atribute Launchpoint wizard.\n\n\n![Attribute Event](aeuipage1.jpg)\n\nThe \"validate\" script should be quite simple:\n\n```python\nif purchaseprice > 200:\n  service.error(\"some\",\"error\")\n```\n\nAs apparent, we use the implicit variable `purchaseprice` (that being the attribute on which the launchpoint is based on) \nand we also use the `service.error(..) to throw the needed MXException for this validation.  \n\n\nThe next script would be for the Attribute Action event. Here is a way to write the script:\n\n```python\nif purchaseprice >= 100:\n  vend_required=True\nelse:\n  vend_required=False\n  rc = purchaseprice/2\n```\nAs apparent, the above script leverages 2 explicitly defined OUT variables, `vend` for attribute \"vendor\" and `rc` for attribute \"replacementcost\".\nBy leveraging the implicit variable vend_required we can control the state of the \"vendor\" attribute (required or not). We also can set the \"replacementcost\" by setting the `rc`.\nAnother way to do this without using any of these explicitly defined variables is to leverage the standard mbo apis and the implict `mbo` variable.  \n\n\n```python\nfrom psdi.mbo import MboConstants\n\nif purchaseprice >= 100:\n  mbo.setFieldFlag(\"vendor\",MboConstants.READONLY, True)\nelse:\n  mbo.setFieldFlag(\"vendor\",MboConstants.READONLY, False)\n  mbo.setValue(\"replacementcost\",purchaseprice/2)\n```  \nNote that with the latter approach, the script developer controls more, but need to be aware of Mbo apis. \nFor example if the \"replacementcost\" field is readonly both scripts will fail as the Mbo framework will reject the `setValue` call \non that attribute. \nTo get around that, one can leverage the variable binding metadata - \"Suppress Access Control\". By setting that, the script framework can set the `rc` variable value to the \"replacementcost\" whether its readonly or not.\nHowever this will only work for the script code that uses the variable binding. For the latter script (which leverages the mbo apis) the script code will need to leverage the MboConstants setting to acheieve the same.\n\n```python\nfrom psdi.mbo import MboConstants\n..\nmbo.setValue(\"replacementcost\",purchaseprice/2, MboConstants.NOACCESSCHECK)\n```  \n\nThe next use case would be to make the calculated field that we created\nfor the Asset sparepart total quantity calculation more real-time. For example if\nwe change the quantities of the related spareparts we should see the calculated\nfield [sparepartqty] value change real-time. For that we would need to create a\nscript - attribute launchpoint for attribute \"quantity\" for \"sparepart\" object with the \"Action\" event. The explicit\nvariable binding is shown below:  \n\n\n|Variable name|Variable type|Binding|\n|:-----------|:--------|:----------------------|\n|sptqt|INOUT|&owner&.sparepartqty|\n\n\nAs apparent from the binding the variable sptqt is bound to the owner's [Asset\nmbo] sparepartqty attribute. We do have to set the sptqt variable with the \"No\nAccess Check\" as its marked as readonly by our original [Object launch point]\nscript at the initialization of the Asset mbo. As explained before the variable\nquantity [the attribute on which the script is listening to] would be implicitly\ninjected in the script as that's the attribute on which the script is listening. The\nscript will look as below.\n\n\n```python\nsptqt=sptqt+quantity-quantity_previous\n```\n\n\nHere we see the use of the implicit variable quantity_previous. This represents\nthe value of the quantity attribute prior to the modification ie the value at the\ninitialization of the sparepart Mbo. And the variable quantity of course holds the\ncurrent modified value of the quantity attribute.  \n\n\nSo combination of this script along with the Object Launch point script can give\nyou a complete calculated field logic implemented using the scripting framework\nwith 3 lines of script and a few clicks in the Script Wizard.  \n\nNote that Maximo Formulas do provide a simpler way to handle this use case. \nSo if you havent not delved into Formulas - this use case would be a good one to solve with Formulas.\n\n\n### Creating lookups using scripts\n\nCreating lookups can be done using the attribute launch point \"Retrieve List\" option. As with any\nattribute launchpoint, we are going to hook the script up with the mbo attribute on which we\nwant the lookup to happen. While writing the script is enough for lookups to work from REST apis (`GET getlist~attr`), it is not enough for lookups to work either in Graphite or in Classic UI. \nFor classic UI We need to make an entry in the `lookups.xml` for the lookup dialog. We also need to associate the\nlookup name to the mbo attribute in the corresponding presentation xml(s). In the example below we would want to\nwrite a lookup for the \"address5\" attribute in the Address mbo for the multisite application. The\n\"address5\" maps to a country name using the country code. Say we want to use some of the\nexternal rest apis available that provides the list of countries. There are quite of few of those out\nthere. But for this example, we will assume a simple HTTP GET call with a user/password (basic auth) and a response like below\n\n```json\n{\"USA\" : \"United State Of America\", \"CAN\":\"Canada\", \"GBR\": \"United Kingdom\"}\n```\n\nNext we write the \"retrieve list\" script. This example is in Nashorn JS, just to give a sample in JS and to leverage some of the \nnative json parsing capabilities of Nashorn JS. Note that we will cover json handling in scripts later in more details.\n\n```javascript\nimportPackage(java.util)\nimportPackage(Packages.psdi.server)\n\nvar jsonResp = service.httpget(\"..url..\",\"..userid..\",\"..password..\");\nvar countries = JSON.parse(jsonResp);\nvar countriesSet = MXServer.getMXServer().getMboSet(\"COUNTRY\", userInfo);\nfor(var cnt in countries)\n{\n\tvar cntMbo = countriesSet.add();\n\tcntMbo.setValue(\"name\",cnt);\n\tcntMbo.setValue(\"description\",countries[cnt]);\n}\nlistMboSet = countriesSet;\nsrcKeys=[\"NAME\"];\ntargetKeys=[\"ADDRESS5\"];\n```\n\nNote the use of the implicit variable `listMboSet` which holds the mboset to be\nused in the lookup. The target mbo attribute where the value is going to set has a different name\n(address5) than the src attribute name (\"name\" in COUNTRY mbo). So we leverage the implicit vars\n`srcKeys` and `targetKeys` to let the system know where to set the selected value.\n\n\n### Init and Init Value attribute events\n\n\nThese 2 atributes events help set the attribute flags (init event) and initialize the value (init value event). \nThis can be done using Object init event too - but that is where performance considerations come into play. \nThese Attribute events would leverage the Maximo frameworks just-in-time initialization. This implies that those scripts would get called only if the framework needs to access that attribute.\nObject init event would initialize the attriubute whether its needed or not.\n\n\nA sample script to initialize the \"priority\" attribute is shown below:\n\n\n```\nif mbo.toBeAdded()==True and mbo.getString(\"site\")==\"BEDFORD\":\n  thisvalue = 1\n```\n\nNote that the implicit variable `thisvalue` represents the attribute for this launchpoint.\n\n\nSimilarly, the \"init\" event provides implicit variables for setting the required/readonly and hidden flags.\n\n\n|Variable name|Variable type|Purpose|\n|:-----------|:---------|:-------------------|\n|thisvalue_required|OUT|Set the attribute to be required or not|\n|thisvalue_readonly|OUT|Set the attribute to be readonly or not|\n|thisvalue_hidden|OUT|Set the attribute to be hidden or not|\n\n\nA sample script for this event is shown below:\n\n\n```\nif mbo.toBeAdded()==True and mbo.getString(\"site\")==\"BEDFORD\":\n  thisvalue_required = True\n```\n\nAs apparent, this can be leveraged to set flags to the attribute (for this launchpoint) - conditionally - and the framework will invoke this only when it is being referred to.  ","type":"Mdx","contentDigest":"1b3a019b6b100cc507b941de2cfe5970","owner":"gatsby-plugin-mdx","counter":146},"frontmatter":{"title":"Attribute Launchpoint"},"exports":{},"rawBody":"---\ntitle: Attribute Launchpoint\n---\n\n## Attribute Launchpoint\nNext we cover the Attribute Launch Point where one can customize the field\nvalidation, action, initialization and lookups using the scripting framework. As before the script will\nhave access to the event Mbo [via implicit variable “mbo”] as well as all the\nrelated Mbos. In addition the modified attribute would also be available implicitly\nas a variable inside the script. The variable name would be the lower case value\nof the modified attribute name. The script will have access to the event Mbo [via the implicit variable\n`mbo`], the MboSet as well as all the related Mbos. A couple of examples below would help explain. \nTo design scripts using Attribute Launchpoint launch the “Create Scripts with Attribute Launch Point” wizard as shown below.\n\n![Attribute Launchpoint UI](alpui.jpg)\n\n\n### Validate and Action Events\nAs before we continue customizing the Asset Mbo. The use case this time is to\nadd custom business logic based on the Asset purchase price [attribute\npurchaseprice in Asset] value. For example we want to set the vendor field\nrequired or not required based on the purchaseprice attribute value and also to\ncalculate the replacement cost based on the purchase price. We also want to\nmake sure the purchase price does not exceed a maximum allowed value.  \n\nBased on the use case we know that the logic has to injected at the modification\nof the purchasprice attribute value – which implies it should be modeled as an\nAttribute Launch Point. Note that there is a validation element in the requirement - where the purchaseprice cannot exceed a certain limit. \nThere is also an action element wherein the state of the vendor attribute and the replacementcost value gets set based on the purchaseprice value. \nThe first requirement (of validation) should be handled by the Attriubute validate event and the 2nd one needs to be handled in the Attribute action event. \nBelow we show the screen shot for the events available in Atribute Launchpoint wizard.\n\n\n![Attribute Event](aeuipage1.jpg)\n\nThe \"validate\" script should be quite simple:\n\n```python\nif purchaseprice > 200:\n  service.error(\"some\",\"error\")\n```\n\nAs apparent, we use the implicit variable `purchaseprice` (that being the attribute on which the launchpoint is based on) \nand we also use the `service.error(..) to throw the needed MXException for this validation.  \n\n\nThe next script would be for the Attribute Action event. Here is a way to write the script:\n\n```python\nif purchaseprice >= 100:\n  vend_required=True\nelse:\n  vend_required=False\n  rc = purchaseprice/2\n```\nAs apparent, the above script leverages 2 explicitly defined OUT variables, `vend` for attribute \"vendor\" and `rc` for attribute \"replacementcost\".\nBy leveraging the implicit variable vend_required we can control the state of the \"vendor\" attribute (required or not). We also can set the \"replacementcost\" by setting the `rc`.\nAnother way to do this without using any of these explicitly defined variables is to leverage the standard mbo apis and the implict `mbo` variable.  \n\n\n```python\nfrom psdi.mbo import MboConstants\n\nif purchaseprice >= 100:\n  mbo.setFieldFlag(\"vendor\",MboConstants.READONLY, True)\nelse:\n  mbo.setFieldFlag(\"vendor\",MboConstants.READONLY, False)\n  mbo.setValue(\"replacementcost\",purchaseprice/2)\n```  \nNote that with the latter approach, the script developer controls more, but need to be aware of Mbo apis. \nFor example if the \"replacementcost\" field is readonly both scripts will fail as the Mbo framework will reject the `setValue` call \non that attribute. \nTo get around that, one can leverage the variable binding metadata - \"Suppress Access Control\". By setting that, the script framework can set the `rc` variable value to the \"replacementcost\" whether its readonly or not.\nHowever this will only work for the script code that uses the variable binding. For the latter script (which leverages the mbo apis) the script code will need to leverage the MboConstants setting to acheieve the same.\n\n```python\nfrom psdi.mbo import MboConstants\n..\nmbo.setValue(\"replacementcost\",purchaseprice/2, MboConstants.NOACCESSCHECK)\n```  \n\nThe next use case would be to make the calculated field that we created\nfor the Asset sparepart total quantity calculation more real-time. For example if\nwe change the quantities of the related spareparts we should see the calculated\nfield [sparepartqty] value change real-time. For that we would need to create a\nscript - attribute launchpoint for attribute \"quantity\" for \"sparepart\" object with the \"Action\" event. The explicit\nvariable binding is shown below:  \n\n\n|Variable name|Variable type|Binding|\n|:-----------|:--------|:----------------------|\n|sptqt|INOUT|&owner&.sparepartqty|\n\n\nAs apparent from the binding the variable sptqt is bound to the owner's [Asset\nmbo] sparepartqty attribute. We do have to set the sptqt variable with the \"No\nAccess Check\" as its marked as readonly by our original [Object launch point]\nscript at the initialization of the Asset mbo. As explained before the variable\nquantity [the attribute on which the script is listening to] would be implicitly\ninjected in the script as that's the attribute on which the script is listening. The\nscript will look as below.\n\n\n```python\nsptqt=sptqt+quantity-quantity_previous\n```\n\n\nHere we see the use of the implicit variable quantity_previous. This represents\nthe value of the quantity attribute prior to the modification ie the value at the\ninitialization of the sparepart Mbo. And the variable quantity of course holds the\ncurrent modified value of the quantity attribute.  \n\n\nSo combination of this script along with the Object Launch point script can give\nyou a complete calculated field logic implemented using the scripting framework\nwith 3 lines of script and a few clicks in the Script Wizard.  \n\nNote that Maximo Formulas do provide a simpler way to handle this use case. \nSo if you havent not delved into Formulas - this use case would be a good one to solve with Formulas.\n\n\n### Creating lookups using scripts\n\nCreating lookups can be done using the attribute launch point \"Retrieve List\" option. As with any\nattribute launchpoint, we are going to hook the script up with the mbo attribute on which we\nwant the lookup to happen. While writing the script is enough for lookups to work from REST apis (`GET getlist~attr`), it is not enough for lookups to work either in Graphite or in Classic UI. \nFor classic UI We need to make an entry in the `lookups.xml` for the lookup dialog. We also need to associate the\nlookup name to the mbo attribute in the corresponding presentation xml(s). In the example below we would want to\nwrite a lookup for the \"address5\" attribute in the Address mbo for the multisite application. The\n\"address5\" maps to a country name using the country code. Say we want to use some of the\nexternal rest apis available that provides the list of countries. There are quite of few of those out\nthere. But for this example, we will assume a simple HTTP GET call with a user/password (basic auth) and a response like below\n\n```json\n{\"USA\" : \"United State Of America\", \"CAN\":\"Canada\", \"GBR\": \"United Kingdom\"}\n```\n\nNext we write the \"retrieve list\" script. This example is in Nashorn JS, just to give a sample in JS and to leverage some of the \nnative json parsing capabilities of Nashorn JS. Note that we will cover json handling in scripts later in more details.\n\n```javascript\nimportPackage(java.util)\nimportPackage(Packages.psdi.server)\n\nvar jsonResp = service.httpget(\"..url..\",\"..userid..\",\"..password..\");\nvar countries = JSON.parse(jsonResp);\nvar countriesSet = MXServer.getMXServer().getMboSet(\"COUNTRY\", userInfo);\nfor(var cnt in countries)\n{\n\tvar cntMbo = countriesSet.add();\n\tcntMbo.setValue(\"name\",cnt);\n\tcntMbo.setValue(\"description\",countries[cnt]);\n}\nlistMboSet = countriesSet;\nsrcKeys=[\"NAME\"];\ntargetKeys=[\"ADDRESS5\"];\n```\n\nNote the use of the implicit variable `listMboSet` which holds the mboset to be\nused in the lookup. The target mbo attribute where the value is going to set has a different name\n(address5) than the src attribute name (\"name\" in COUNTRY mbo). So we leverage the implicit vars\n`srcKeys` and `targetKeys` to let the system know where to set the selected value.\n\n\n### Init and Init Value attribute events\n\n\nThese 2 atributes events help set the attribute flags (init event) and initialize the value (init value event). \nThis can be done using Object init event too - but that is where performance considerations come into play. \nThese Attribute events would leverage the Maximo frameworks just-in-time initialization. This implies that those scripts would get called only if the framework needs to access that attribute.\nObject init event would initialize the attriubute whether its needed or not.\n\n\nA sample script to initialize the \"priority\" attribute is shown below:\n\n\n```\nif mbo.toBeAdded()==True and mbo.getString(\"site\")==\"BEDFORD\":\n  thisvalue = 1\n```\n\nNote that the implicit variable `thisvalue` represents the attribute for this launchpoint.\n\n\nSimilarly, the \"init\" event provides implicit variables for setting the required/readonly and hidden flags.\n\n\n|Variable name|Variable type|Purpose|\n|:-----------|:---------|:-------------------|\n|thisvalue_required|OUT|Set the attribute to be required or not|\n|thisvalue_readonly|OUT|Set the attribute to be readonly or not|\n|thisvalue_hidden|OUT|Set the attribute to be hidden or not|\n\n\nA sample script for this event is shown below:\n\n\n```\nif mbo.toBeAdded()==True and mbo.getString(\"site\")==\"BEDFORD\":\n  thisvalue_required = True\n```\n\nAs apparent, this can be leveraged to set flags to the attribute (for this launchpoint) - conditionally - and the framework will invoke this only when it is being referred to.  ","fileAbsolutePath":"/home/travis/build/maximo-app-framework/maximo-autoscript-documentation/src/pages/attributescripts/attributelaunch.mdx"}}},
    "staticQueryHashes": ["1364590287","137577622","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}