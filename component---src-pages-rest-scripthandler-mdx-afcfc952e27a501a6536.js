"use strict";(self.webpackChunkmas_playbook=self.webpackChunkmas_playbook||[]).push([[1708],{3297:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return s},default:function(){return c}});var A=a(3366),r=(a(7294),a(4983)),i=a(4295),n=["components"],s={},o={_frontmatter:s},l=i.Z;function c(e){var t=e.components,a=(0,A.Z)(e,n);return(0,r.kt)(l,Object.assign({},o,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The REST API can support most customer use cases for retrieving or processing data, through simple configuration. Occasionally, there are scenarios where that is difficult to do with existing APIs. In those cases you can create a script and not a launch point and call it with either a GET or POST like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"https://myurl.com/maximo/api/script/SCRIPTNAME?lean=1\n")),(0,r.kt)("h2",null,"Implicit variables"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Variable name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"request"),(0,r.kt)("td",{parentName:"tr",align:"left"},"OslcRequest representation of the request being made. This exposes important methods such as request.getQueryParam(“parameter”) and request.getHeader(“header”) to retrieve values provided as a query parameter or header respectively. You can also access the UserInfo by calling request.getUserInfo().")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"requestData"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The byte[] representation of data sent in the body of the request.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"requestDataS"),(0,r.kt)("td",{parentName:"tr",align:"left"},"When the request byte[] represents a UTF-8 string, this will contain a Java String version of the data. In cases where it is not a string (or cannot be encoded to UTF-8), this variable will not be declared.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"httpMethod"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Whether this was a GET, POST, PUT, etc. Can also be retrieved by calling request.getHttpMethod().")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"responseData"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The script sets this as either a byte[] or String to return in the response. This is not required if you do not intend to return a response.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"responseHeaders"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The script can provide additional headers to this HashMap to return to the calling application.")))),(0,r.kt)("h2",null,"Example script"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# This example will change the user\'s default insert site based on the query parameter. \n# This is different than setting it on the MAXUSER record because this updates for the current session.\nfrom psdi.server import MXServer\nmaxServer=MXServer.getMXServer()\nsiteid=request.getQueryParam("siteid")\nif siteid and maxServer.isValidSite(siteid):\n    userInfo=request.getUserInfo()\n    userSet=maxServer.getMboSet("MAXUSER",userInfo)\n    userSet.setQbeExactMatch(True)\n    userSet.setQbe("userid",userInfo.getUserName())\n    userMbo=userSet.moveFirst()\n    if userMbo:\n        userMbo.setValue("DEFSITE",siteid)\n        securityService=maxServer.lookup("SECURITY")\n        securityService.refreshSecurityInfo(userInfo.getUserName(),userMbo,userMbo.getMboSet("PERSON").getMbo(0))\n        userSet.save()\n    userSet.close()\nelse:\n    service.error("system","invalidsite",[siteid])\n')),(0,r.kt)("p",null,"Call with a GET/POST request like: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"https://myurl.com/maximo/oslc/script/setinsertsite?lean=1&siteid=BEDFORD\n")),(0,r.kt)("h1",null,"Security"),(0,r.kt)("p",null,"Out of the box, any automation script can be called by an authenticated user via the REST API. There are two ways that this can be secured to restrict who can call these automation scripts."),(0,r.kt)("h2",null,"Restrict the Script Handler"),(0,r.kt)("p",null,"In the Object Structures application, under the More Actions open the “Add/Modify API Route” dialog. Filter for the name “script” and you should see two results (one for POST and one for GET requests). For each entry you can tie an application and option name that will require the user to have that specific permission to be able to use the script handler via the REST API. This will apply to all automation scripts.\n",(0,r.kt)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",(0,r.kt)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"20.13888888888889%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAduhAP/EABYQAQEBAAAAAAAAAAAAAAAAAAEQIf/aAAgBAQABBQI0n//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABYQAQEBAAAAAAAAAAAAAAAAAAEQEf/aAAgBAQABPyF4t//aAAwDAQACAAMAAAAQC/8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8QZ//EABgQAQADAQAAAAAAAAAAAAAAAAEAETEh/9oACAEBAAE/EGXoXaid1lT/2Q==')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,r.kt)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"Script Handler Security",title:"Script Handler Security",src:"/maximo-autoscript-documentation/static/648d2bc9d9af296e8c521eae935a5e2e/2e753/scripthandlersecurity.jpg",srcSet:["/maximo-autoscript-documentation/static/648d2bc9d9af296e8c521eae935a5e2e/69549/scripthandlersecurity.jpg 288w","/maximo-autoscript-documentation/static/648d2bc9d9af296e8c521eae935a5e2e/473e3/scripthandlersecurity.jpg 576w","/maximo-autoscript-documentation/static/648d2bc9d9af296e8c521eae935a5e2e/2e753/scripthandlersecurity.jpg 1152w","/maximo-autoscript-documentation/static/648d2bc9d9af296e8c521eae935a5e2e/660ff/scripthandlersecurity.jpg 1422w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n    ")),(0,r.kt)("h2",null,"Restrict individual automation script"),(0,r.kt)("p",null,"If you need more granular security (IE specific authorization for specific scripts) you can create two variables (authapp & authsigoption) on the automation script. These need to be a variable type of IN (or INOUT) with a binding type of LITERAL.\n",(0,r.kt)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"780px"}},"\n      ",(0,r.kt)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"38.19444444444444%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdwJQP/EABYQAAMAAAAAAAAAAAAAAAAAAAAQEf/aAAgBAQABBQIq/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAERUf/aAAgBAQABPyFN4VhWf//aAAwDAQACAAMAAAAQ/D//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxCq/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxAAAQQDAAAAAAAAAAAAAAAAAAERIWFRobH/2gAIAQEAAT8QddMJFlRVpT//2Q==')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,r.kt)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"Script Handler Variables",title:"Script Handler Variables",src:"/maximo-autoscript-documentation/static/8e2c5dba15dafc341aacc2bbccd33fce/90725/scripthandlerscriptvars.jpg",srcSet:["/maximo-autoscript-documentation/static/8e2c5dba15dafc341aacc2bbccd33fce/69549/scripthandlerscriptvars.jpg 288w","/maximo-autoscript-documentation/static/8e2c5dba15dafc341aacc2bbccd33fce/473e3/scripthandlerscriptvars.jpg 576w","/maximo-autoscript-documentation/static/8e2c5dba15dafc341aacc2bbccd33fce/90725/scripthandlerscriptvars.jpg 780w"],sizes:"(max-width: 780px) 100vw, 780px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n    ")))}c.isMDXComponent=!0},4295:function(e,t,a){a.d(t,{Z:function(){return y}});var A=a(7294),r=a(8650),i=a.n(r),n=a(5444),s=a(6949),o=a(3293),l=a(5900),c=a.n(l),d=function(e){var t,a=e.title,r=e.theme,i=e.tabs,n=void 0===i?[]:i;return A.createElement("div",{className:c()("PageHeader-module--page-header--NqfPe",(t={},t["PageHeader-module--with-tabs--vbQ-W"]=n.length,t["PageHeader-module--dark-mode--WCeH8"]="dark"===r,t))},A.createElement("div",{className:"bx--grid"},A.createElement("div",{className:"bx--row"},A.createElement("div",{className:"bx--col-lg-12"},A.createElement("h1",{id:"page-title",className:"PageHeader-module--text--Er2EO"},a)))))},p=function(e){var t=e.relativePagePath,a=e.repository,r=(0,n.useStaticQuery)("1364590287").site.siteMetadata.repository,i=a||r,s=i.baseUrl,o=i.subDirectory,l=s+"/edit/"+i.branch+o+"/src/pages"+t;return s?A.createElement("div",{className:"bx--row EditLink-module--row--BEmSX"},A.createElement("div",{className:"bx--col"},A.createElement("a",{className:"EditLink-module--link--IDrl1",href:l},"Edit this page on GitHub"))):null},m=a(4275),u=a(1721),g=function(e){function t(){return e.apply(this,arguments)||this}return(0,u.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,a=e.tabs,r=e.slug,s=r.split("/").filter(Boolean).slice(-1)[0],o=a.map((function(e){var t,a=i()(e,{lower:!0,strict:!0}),o=a===s,l=new RegExp(s+"/?(#.*)?$"),d=r.replace(l,a);return A.createElement("li",{key:e,className:c()((t={},t["PageTabs-module--selected-item--aBB0K"]=o,t),"PageTabs-module--list-item--024o6")},A.createElement(n.Link,{className:"PageTabs-module--link--Kz-7R",to:""+d},e))}));return A.createElement("div",{className:"PageTabs-module--tabs-container--Cdfzw"},A.createElement("div",{className:"bx--grid"},A.createElement("div",{className:"bx--row"},A.createElement("div",{className:"bx--col-lg-12 bx--col-no-gutter"},A.createElement("nav",{"aria-label":t},A.createElement("ul",{className:"PageTabs-module--list--xLqxG"},o))))))},t}(A.Component),h=g,b=a(2881),E=a(6958),f=a(36),N=function(e){var t=e.date,a=new Date(t);return t?A.createElement(f.X2,{className:"last-modified-date-module--row--XJoYQ"},A.createElement(f.sg,null,A.createElement("div",{className:"last-modified-date-module--text--ogPQF"},"Page last updated: ",a.toLocaleDateString("en-GB",{day:"2-digit",year:"numeric",month:"long"})))):null},y=function(e){var t=e.pageContext,a=e.children,r=e.location,l=e.Title,c=t.frontmatter,u=void 0===c?{}:c,g=t.relativePagePath,f=t.titleType,y=u.tabs,k=u.title,B=u.theme,Q=u.description,v=u.keywords,w=u.date,x=(0,E.Z)().interiorTheme,S=(0,n.useStaticQuery)("2456312558").site.pathPrefix,P=S?r.pathname.replace(S,""):r.pathname,j=y?P.split("/").filter(Boolean).slice(-1)[0]||i()(y[0],{lower:!0}):"",T=B||x;return A.createElement(o.Z,{tabs:y,homepage:!1,theme:T,pageTitle:k,pageDescription:Q,pageKeywords:v,titleType:f},A.createElement(d,{title:l?A.createElement(l,null):k,label:"label",tabs:y,theme:T}),y&&A.createElement(h,{title:k,slug:P,tabs:y,currentTab:j}),A.createElement(b.Z,{padded:!0},a,A.createElement(p,{relativePagePath:g}),A.createElement(N,{date:w})),A.createElement(m.Z,{pageContext:t,location:r,slug:P,tabs:y,currentTab:j}),A.createElement(s.Z,null))}}}]);
//# sourceMappingURL=component---src-pages-rest-scripthandler-mdx-afcfc952e27a501a6536.js.map